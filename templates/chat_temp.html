


<!DOCTYPE html>
<html lang="en">


<head>
  
  <meta charset="UTF-8">
  <title>Chatbot</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='static/style_chat.css') }}"> -->
  <link href="https://fonts.googleapis.com/css?family=Ek+Mukta" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    
  <link rel="stylesheet" href="static/chat_style.css">
 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>

<body>

    <nav class="navbar navbar-expand-lg ">
      <div class="container-fluid">
        <a class="navbar-brand" href="#"></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#"></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">होम</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">जानकारी</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">संपर्क</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">पिछले सत्र</a>
            </li>
           <!-- <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Dropdown
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
              </ul>
            </li>
            --> 
          
          </ul>
          
        </div>
      </div>
    </nav>

  <!-- partial:index.partial.html -->
  <section class="msger">
    <header class="msger-header">
      <div class="msger-header-title">
        <i class="fas fa-bug"></i> Chatbot <i class="fas fa-bug"></i>
      </div>
    </header>

    <main class="msger-chat">
      <div class="msg left-msg">
        <div class="msg-img" style="background-image: url(https://image.flaticon.com/icons/svg/327/327779.svg)"></div>

        <div class="msg-bubble">
          <div class="msg-info">
            <div class="msg-info-name">Chodumal</div>
            <div class="msg-info-time"> 12:00</div>
          </div>

          <div class="msg-text">
            नमस्कार

            
          </div>

        </div>
       
      </div>
      
      <div class="msg left-msg">
        <div class="msg-img" style="background-image: url(https://image.flaticon.com/icons/svg/327/327779.svg)"></div>

        <div class="msg-bubble">
          <div class="msg-info">
            <div class="msg-info-name">Chodumal</div>
            <div class="msg-info-time"> 12:00</div>
          </div>
          <div class="msg-text">
            बातचीत शुरू करें?
            <br>
            <button  id = "yes" onclick = 'botResponse("हाँ")' name = "btn" value="yes" class="opt-btn"> हाँ </button>

            <a href="/chat">
            
            <button  id = "no" name = "btn" value="no" class="opt-btn"> नहीं </button>
                    
            </a>
          </div>
            
  
          </div>
        </div>
       
      </div>
    </main>

    <form class="msger-inputarea">
      <input type="text" class="msger-input" id="textInput" placeholder="" autocomplete="off">
      <button type="submit" class="msger-send-btn"><img src="static/images/send.png" height="60px" width="60px"></button>
    </form>
  </section>
  <!-- partial -->
  <script src='https://use.fontawesome.com/releases/v5.0.13/js/all.js'></script>
  <script>

    const msgerForm = get(".msger-inputarea");
    const msgerInput = get(".msger-input");
    const msgerChat = get(".msger-chat");


    // Icons made by Freepik from www.flaticon.com
    const BOT_IMG = "images/chatbot.jpg";
    const PERSON_IMG = "images/chatbot.jpg";
    const BOT_NAME = "    ChatBot";
    const PERSON_NAME = "You";

    msgerForm.addEventListener("submit", event => {
      event.preventDefault();

      const msgText = msgerInput.value;
      if (!msgText) return;

      // appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
      msgerInput.value = "";
      botResponse(msgText);
    });

    function appendMessage(name, img, side, text, hidden, options, red, redurl) {
      //   Simple solution for small apps
      buttons = "";
      // if(hidden=="false"){
      //   buttons += "<div> ";
      //   for(opt in options){
      //       buttons += "<button class='opt-btn' name='' value='' > " + options[opt] + "</button>"
      //   }
      //   buttons += "</div>";
      // }

      redirect = "";
      if(red=="true"){
        // redirect += `<form action='${redurl}' method='POST'>
        //     <button class="opt-btn" type='submit'> Click here </button>
        //     </form>
        //   `

        redirect += `
          <a href = "${redurl}" > <button class="opt-btn" type='submit'> Click here </button> </a>
        `;
      }

      msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>

  <div class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      <div class="msg-info-time">${formatDate(new Date())}</div>
    </div>

    <div class="msg-text">${text}</div>
    ${redirect}
  </div>
</div>
`;

      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }

    function botResponse(rawText) {
      appendMessage(PERSON_NAME, PERSON_IMG, "right", rawText);
      // Bot Response
      $.get("/get-bot-response", { msg: rawText }).done(function (data) {
        console.log(rawText);
        console.log(data);
        const msgText = data["message"];
        const hidden = data["hidden"];
        const buttons = data["buttons"];
        const red = data["redirect"]
        const redurl = data['redirect_url']
        
        appendMessage(BOT_NAME, BOT_IMG, "left", msgText, hidden, buttons, red, redurl);
        
      });

    }


    // Utils
    function get(selector, root = document) {
      return root.querySelector(selector);
    }

    function formatDate(date) {
      const h = "0" + date.getHours();
      const m = "0" + date.getMinutes();

      return `${h.slice(-2)}:${m.slice(-2)}`;
    }

    

    $(function() {
          $('a#test').on('click', function(e) {
            e.preventDefault()
            $.getJSON('/start',
                function(data) {
              //do nothing
            });
            return false;
          });
        });

        // $(function() {
        //   $('#b1').on('click', function(e) {
        //     e.preventDefault()
        //     $.getJSON('/route_button',
        //         function(data) {
        //       //do nothing
        //     });
        //     return false;
        //   });
        // });

//         $("#form_button").submit(function(e) {
//     e.preventDefault();
// });
  </script>

</body>

</html>